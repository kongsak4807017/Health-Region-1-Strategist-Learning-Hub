# Module 1.3: การตรวจสอบความน่าเชื่อถือของข้อมูล (Data Verification & Validation)
## เอกสารประกอบการสอน - ฉบับละเอียด

---

## สารบัญ
1. [กรอบ TRUST](#1-กรอบ-trust)
2. [เทคนิค Cross-Validation](#2-เทคนิค-cross-validation)
3. [การตรวจสอบคุณภาพข้อมูล](#3-การตรวจสอบคุณภาพข้อมูล)
4. [การจัดการกับปัญหาข้อมูล](#4-การจัดการกับปัญหาข้อมูล)

---

## 1. กรอบ TRUST

กรอบ TRUST เป็นเครื่องมือสำหรับประเมินความน่าเชื่อถือของข้อมูลสุขภาพ

### 1.1 T - Timeliness (ความทันสมัย)

**คำถามที่ต้องถาม:**
- ข้อมูลเป็นของช่วงเวลาใด?
- มีความล่าช้าจากการเกิดเหตุจริงเท่าใด?
- ข้อมูลปัจจุบันเพียงพอหรือไม่?

**ตัวอย่างในบริบทไทย:**
| แหล่งข้อมูล | ความถี่ | ความล่าช้า | หมายเหตุ |
|------------|--------|-----------|---------|
| DDC โรคติดต่อ | รายวัน | 1-3 วัน | Real-time surveillance |
| NHSO Claims | รายเดือน | 1-2 เดือน | รอการเคลียร์ค่ารักษา |
| MOPH สถิติ | รายปี | 6-12 เดือน | รอสรุปผล |
| NSO Survey | 3-5 ปี | 1-2 ปี | ต้องประมวลผล |

**เกณฑ์การประเมิน:**
- ✅ Excellent: ข้อมูลปีปัจจุบัน สมบูรณ์ >90%
- ⚠️ Good: ข้อมูลปีปัจจุบัน สมบูรณ์ 70-90%
- ❌ Poor: ข้อมูลล่าช้า >1 ปี หรือสมบูรณ์ <70%

### 1.2 R - Representativeness (ความเป็นตัวแทน)

**คำถามที่ต้องถาม:**
- ตัวอย่างครอบคลุมประชากรเป้าหมายหรือไม่?
- มี Bias ในการเลือกตัวอย่างหรือไม่?
- ขนาดตัวอย่างเพียงพอหรือไม่?

**ประเภทของ Bias:**
```
1. Selection Bias: การเลือกตัวอย่างไม่สุ่ม
   ตัวอย่าง: สำรวจเฉพาะผู้มา รพ. → ไม่เห็นผู้ไม่มา รพ.

2. Information Bias: วิธีเก็บข้อมูลผิดเพี้ยน
   ตัวอย่าง: Self-reported smoking (under-report)

3. Non-response Bias: ผู้ไม่ตอบแบบสอบถามมีลักษณะต่าง
   ตัวอย่าง: คนรวยไม่ตอบแบบสำรวจรายได้
```

**การตรวจสอบในระบบรายงาน:**
| ปัญหา | ตรวจพบได้จาก | แก้ไข |
|------|------------|------|
| Under-reporting | Coverage check | Imputation |
| Duplicate records | Unique ID check | Deduplication |
| Missed population | Denominator check | Adjustment |

### 1.3 U - Uniformity (ความสม่ำเสมอ)

**คำถามที่ต้องถาม:**
- วิธีการเก็บข้อมูลเป็นมาตรฐานเดียวกันหรือไม่?
- นิยามเปลี่ยนแปลงระหว่างช่วงเวลาหรือไม่?
- มีการฝึกอบรมเจ้าหน้าที่อย่างสม่ำเสมอหรือไม่?

**ตัวอย่างปัญหา:**
```
ปัญหา: การนับ "ผู้ป่วยเบาหวาน" เปลี่ยนแปลง
- ปี 2563: วินิจฉัย DM ครั้งเดียว
- ปี 2564 เป็นต้นไป: วินิจฉัย DM + HbA1c > 7%

ผล: อัตราผู้ป่วย DM ลดลงอย่างฉับพลันในปี 2564
(ไม่ใช่เพราะคนหายป่วยจริง!)
```

**การตรวจสอบ:**
- อ่าน Metadata/Documentation
- ตรวจสอบ Time series ผิดปกติ
- สอบถามเจ้าหน้าที่

### 1.4 S - Source (แหล่งที่มา)

**คำถามที่ต้องถาม:**
- หน่วยงานมีความน่าเชื่อถือหรือไม่?
- มีระบบควบคุมคุณภาพหรือไม่?
- มีการตรวจสอบจากภายนอกหรือไม่?

**การจัดระดับแหล่งข้อมูล:**

| ระดับ | ลักษณะ | ตัวอย่าง |
|------|--------|---------|
| Tier 1 | หน่วยงานรัฐ มีระบบ QC | MOPH, NHSO, NSO |
| Tier 2 | สถาบันวิจัย มี peer review | HSRI, IHPP |
| Tier 3 | องค์กรระหว่างประเทศ | WHO, World Bank |
| Tier 4 | ภาคประชาสังคม | NGO reports |
| Tier 5 | สื่อ/ข้อมูลไม่เป็นทางการ | ข่าว, Social media |

### 1.5 T - Transparency (ความโปร่งใส)

**คำถามที่ต้องถาม:**
- มีเอกสารอธิบายวิธีการเก็บข้อมูลหรือไม่?
- สามารถตรวจสอบกลับได้หรือไม่?
- มีการเปิดเผยข้อจำกัดหรือไม่?

**เอกสารที่ควรมี:**
- [ ] Methodology report
- [ ] Data dictionary
- [ ] Limitations statement
- [ ] Contact person for questions

---

## 2. เทคนิค Cross-Validation

### 2.1 หลักการ

การตรวจสอบความถูกต้องโดยเปรียบเทียบกับแหล่งข้อมูลอื่น

```
Data A ≈ Data B → น่าเชื่อถือ
Data A ≠ Data B → ต้องสืบสาวสาเหตุ
```

### 2.2 วิธีการ Cross-Validation

**A. Triangulation (ใช้ 3 แหล่งข้อมูล)**
```
แหล่งที่ 1: MOPH Mortality
แหล่งที่ 2: NHSO Claims (death cases)
แหล่งที่ 3: NSO (verification survey)

ถ้าตัวเลขใกล้เคียง → Confident
ถ้าตัวเลขต่างมาก → ตรวจสอบ
```

**B. Internal Consistency Check**
```
ตรวจสอบความสอดคล้องภายในชุดข้อมูล:
- ผู้ป่วย DM ต้องมีอายุ >= 0 ( newborn diabetes หายาก)
- หญิงตั้งครรภ์ต้องอายุ 15-49
- การตายต้องมีวันที่ตาย > วันเกิด
```

**C. External Benchmarking**
```
เปรียบเทียบกับมาตรฐานสากล:
- Thailand MMR vs WHO benchmark
- อัตราสูบบุหรี่ไทย vs GBD estimates
```

### 2.3 ตาราง Cross-Validation

| ตัวชี้วัด | แหล่งหลัก | แหล่งที่ 2 | แหล่งที่ 3 | ความแตกต่าง | บันทึก |
|----------|----------|-----------|-----------|------------|-------|
| MMR | MOPH: 45 | WHO: 43 | NSO: - | 4.4% | Acceptable |
| DM Prevalence | MOPH: 8% | NHSO: 7.5% | NSO: 6% | 33% | Need review |

---

## 3. การตรวจสอบคุณภาพข้อมูล

### 3.1 Missing Data

**ประเภทของ Missing Data:**
```
MCAR (Missing Completely at Random): หายแบบสุ่ม
- แก้ไข: Listwise deletion, ถ้า <5%

MAR (Missing at Random): หายตาม pattern
- แก้ไข: Multiple imputation

MNAR (Missing Not at Random): หายตามค่าตัวเอง
- แก้ไข: ต้องเข้าใจ mechanism, sensitivity analysis
```

**การตรวจสอบ:**
```python
# ตัวอย่างการตรวจสอบ Missing data
จำนวน Missing / จำนวนทั้งหมด x 100

ถ้า <5%: ลบ record ได้
ถ้า 5-20%: Imputation
ถ้า >20%: ต้องระวังในการตีความ
```

### 3.2 Outliers

**การตรวจหา Outliers:**

**วิธีที่ 1: Visual Inspection**
- Histogram
- Box plot
- Scatter plot

**วิธีที่ 2: Statistical Methods**
```
IQR Method:
Q1 - 1.5xIQR < ค่าปกติ < Q3 + 1.5xIQR

Z-score:
|Z| > 3 = Outlier
```

**การจัดการ Outliers:**
| สถานการณ์ | การจัดการ |
|----------|----------|
| Data entry error | แก้ไขต้นฉบับ |
| True extreme value | เก็บไว้ แต่ทำ sensitivity analysis |
| ไม่แน่ใจ | ทำ analysis ทั้งสองแบบ (with/without) |

### 3.3 Logical Consistency

**ตรวจสอบความสอดคล้องเชิงตรรกะ:**

```sql
-- ตัวอย่างการตรวจสอบ
SELECT * FROM patients 
WHERE death_date < birth_date;  -- ผิด!

SELECT * FROM women 
WHERE pregnancy_status = 'Yes' 
AND age < 10 OR age > 60;  -- ผิดปกติ!

SELECT * FROM dm_patients 
WHERE diagnosis_date < '1980-01-01';  -- DM registry เริ่มทีหลัง
```

### 3.4 Range Checks

**ตรวจสอบค่าอยู่ในช่วงที่เหมาะสม:**

| ตัวแปร | ช่วงปกติ | ค่าที่น่าสงสัย |
|--------|---------|--------------|
| อายุ | 0-120 | <0 หรือ >120 |
| HbA1c | 4-20% | <3% หรือ >25% |
| อัตราตาย | 0-100% | >100% |
| รหัสจังหวัด | 10-96 | นอกช่วงนี้ |

---

## 4. การจัดการกับปัญหาข้อมูล

### 4.1 ตารางสรุปปัญหาและแนวทางแก้ไข

| ปัญหา | วิธีตรวจพบ | แนวทางแก้ไข | การรายงาน |
|------|----------|------------|----------|
| Missing data | Missing pattern analysis | Imputation/Exclude | ระบุ % missing |
| Outliers | Box plot, Z-score | Verify/Transform | ระบุ method |
| Duplicate | Unique ID check | Deduplication | ระบุจำนวนที่ลบ |
| Inconsistent | Cross-field validation | Rule-based correction | ระบุ rule |
| Outdated | Date check | Exclude/Update | ระบุ data vintage |

### 4.2 Data Quality Report Template

```markdown
## Data Quality Report

### แหล่งข้อมูล: [ชื่อ]
### วันที่ตรวจสอบ: [วันที่]
### ผู้ตรวจสอบ: [ชื่อ]

### 1. สรุปคุณภาพข้อมูล
| ตัวชี้วัด | ค่าที่พบ | เกณฑ์ | ผล |
|----------|---------|-------|-----|
| Completeness | 92% | >90% | ✅ Pass |
| Accuracy | 85% | >90% | ⚠️ Review |
| Timeliness | 2023 | Current | ✅ Pass |
| Consistency | 95% | >95% | ✅ Pass |

### 2. ปัญหาที่พบ
1. [รายละเอียดปัญหา]
2. [รายละเอียดปัญหา]

### 3. การแก้ไข
1. [วิธีแก้ไข]
2. [วิธีแก้ไข]

### 4. ข้อจำกัดที่ยังคงอยู่
- [ข้อจำกัด]

### 5. ข้อแนะนำ
- [ข้อแนะนำ]
```

---

## แบบฝึกหัด: Data Quality Check

**ชุดข้อมูล:** ข้อมูลผู้ป่วยเบาหวานในจังหวัด X

**ตัวอย่างข้อมูลที่มีปัญหา:**
| ID | อายุ | HbA1c | วันวินิจฉัย | จังหวัด |
|----|-----|-------|------------|---------|
| 001 | 45 | 7.2 | 2023-05-15 | เชียงใหม่ |
| 002 | -5 | 8.1 | 2023-06-20 | เชียงใหม่ |
| 003 | 67 | 35.0 | 2023-04-10 | เชียงใหม่ |
| 004 | 52 | 6.8 | 2025-01-15 | เชียงใหม่ |
| 005 | 38 | | 2023-07-22 | ลำพูน |

**คำถาม:**
1. พบปัญหาอะไรบ้าง?
2. แต่ละปัญหาเกิดจากอะไร?
3. จะแก้ไขอย่างไร?

---

## Checklist ตรวจสอบคุณภาพข้อมูล

### ก่อนใช้งาน
- [ ] ตรวจสอบปีข้อมูล (Timeliness)
- [ ] ตรวจสอบความสมบูรณ์ (Completeness)
- [ ] ตรวจสอบ Outliers
- [ ] ตรวจสอบ Logical consistency
- [ ] ตรวจสอบ Duplicates
- [ ] Cross-validate กับแหล่งอื่น

### หลัง Cleaning
- [ ] บันทึกวิธีการแก้ไข
- [ ] สร้าง Data dictionary
- [ ] เขียน Limitations
- [ ] เก็บ Raw data ไว้อ้างอิง

---

*เอกสารฉบับนี้จัดทำเมื่อ: พฤษภาคม 2568*